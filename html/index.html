<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abortion Rates per State</title>
    <link href="http://fonts.googleapis.com/css?family=Corben:bold" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Nobile" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="../static/app.css">
    <!-- <script src="https://d3js.org/d3.v7.min.js"></script> -->
    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ==" crossorigin=""/>
    
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js" integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ==" crossorigin=""></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <style>
		html, body {
			height: 100%;
			margin: 25;
            border: 5;
            border-color: darkcyan;
		}
		.leaflet-container {
			height: 400px;
			width: 600px;
			max-width: 100%;
			max-height: 100%;
            border-color: darkcyan;
		}
	</style>

	<style>#map { width: 1500px; height: 600px; }
    .info { padding: 15px 20px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 10px; } 
    .info h4 { margin: 0 0 5px; color: #777; }
    .legend { text-align: left; line-height: 18px; color: #555; } 
    .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }</style>
    
</head>

<body>
    <h1>Abortion Rates per State</h1>
    <h3> This site was created due to the recent overturn of Roe vs Wade. We feel that people should have an understanding of the abortion laws that pertain to their state. Within this map, you will find information on pregnacy and abortion rates, frequency of abortions, the number of weeks before the abortion ban and more. Toggle with the features and click on a state below to find out more information.</h3>
    <p>


    </p>
    <div id="chart"></div>
    <div id='map'></div>

<script type="text/javascript" src="../html/us-states.js"></script>

<script type="text/javascript">

// SETTING THE INITAL MAP VIEW AND ATTRIBUTIONS
	var map = L.map('map').setView([37.8, -96], 4);
	var tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 10,
		attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
	}).addTo(map);
    map.attributionControl.addAttribution('Abortion Policies & Statistics &copy; <a href="https://data.guttmacher.org/">Guttmacher Institute</a>');

// SETTING THE BASIC MAP FUNCTIONS (ZOOM, RESET, ETC)
var geojson;

function resetHighlight(e) {
    geojson.resetStyle(e.target);
    info.update();}

function zoomToFeature(e) {
    map.fitBounds(e.target.getBounds());}

function onEachFeature(feature, layer) {
    layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
        click: zoomToFeature});}

// HIGHLIGHT FILL FUNCTION
function highlightFeature(e) {
    var layer = e.target;
    layer.setStyle({
        weight: 5,
        color: '#666',
        dashArray: '',
        fillOpacity: 1
    });
    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
    }
    info.update(layer.feature.properties);
	}

/* global statesData */
geojson = L.geoJson(statesData, {
    style: style,
    onEachFeature: onEachFeature
}).addTo(map);


// NEED A FUNCTION FOR THE DIFFERENT VIEWS OF THE MAP

// VIEW FOR NUMBER OF ABORTIONS IN 2020
	// control that shows state info on HOVER
	var info = L.control();

	info.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'info');
		this.update();
		return this._div;
	};

	info.update = function (props) {
		this._div.innerHTML = '<h4>Abortion Access</h4>' +  (props ?
			'<b>' + props.name + 
                '</b><br/>' + props.RestrictiveCategory + 
                '<li>' + props.abortions2020.toLocaleString('en-US') + ' abortions obtained in 2020</li>' +
                '<li>' + "Approximately " + props.AppxWORAcount.toLocaleString('en-US') + " women of reproductive age live in " + props.name + "</li>" + 
                "</b><br/></b><br/>" + "<strong>Current Policies</strong>" +
                '</b><br/>' + props.CurrentPolicies : 'Hover over a state');
	};

	info.addTo(map);

	// FILL COLORS AND CATEGORIES FOR ABORTIONS IN 2020
	function getColorFill_abcount(ab) {
		return ab > 100000 ? '#800026' :
			ab > 75000  ? '#BD0026' :
			ab > 50000  ? '#E31A1C' :
			ab > 25000  ? '#FC4E2A' :
			ab > 10000   ? '#FD8D3C' :
			ab > 5000   ? '#FEB24C' :
			ab > 1000   ? '#FED976' : '#FFEDA0';
	}

    // FILL COLORS FOR RESTRICTIVE CATEGORY
    function getColorFill_rcat(ract) {
        return 	rcat === "Most Restrictive" ? "#404040" :
			rcat === "Very Restrictive"  ? "#686868" :
			rcat === "Restrictive"  ? "#a0a0a0" :
			rcat === "Some Restrictions/Protections"  ? "#bebebe" :
			rcat === "Protective"   ? "#dcdcdc" :
			rcat === "Very Protective"   ? "#f8f8f8" :
			rcat === "Most Protective"   ? "#FFFFFF" : '#ff0000';
    }

    // BORDER COLOR BASED ON RESTRICTVE CATEGORY
    function getColorBorder_rc(rc) {
        return 	rc === "Most Restrictive" ? "#404040" :
			rc === "Very Restrictive"  ? "#686868" :
			rc === "Restrictive"  ? "#a0a0a0" :
			rc === "Some Restrictions/Protections"  ? "#bebebe" :
			rc === "Protective"   ? "#dcdcdc" :
			rc === "Very Protective"   ? "#f8f8f8" :
			rc === "Most Protective"   ? "#FFFFFF" : '#ff0000';
    }

    // FILL COLORS FOR ABORTIONS IN 2020 VIEW
	function style(feature) {
		return {
			weight: 1,
			opacity: 0.9,
			// color: getColorBorder_rc(feature.properties.RestrictiveCategory),
            color: "#FFFFFF",
			dashArray: '0',
			fillOpacity: 1,
			fillColor: getColorFill_abcount(feature.properties.abortions2020)
		};
	}

    // FILL COLORS FOR RESTRICTIVE CATEGORY VIEW
    function style_rc(feature) {
    return {
        weight: 1,
        opacity: 0.9,
        // color: getColorBorder_rc(feature.properties.RestrictiveCategory),
        color: "#FFFFFF",
        dashArray: '0',
        fillOpacity: 1,
        fillColor: getColorFill_rcat(feature.properties.RestrictiveCategory)
    };
    }


    // LEGEND FOR ABORTIONS IN 2020 VIEW
	var legend = L.control({position: 'bottomright'});

	legend.onAdd = function (map) {

		var div = L.DomUtil.create('div', 'info legend');
		var grades = [0, 1000, 5000, 10000, 25000, 50000, 75000, 100000];
		var labels = ["<strong>Abortions Obtained in 2020</strong>"];
		var from, to;

		for (var i = 0; i < grades.length; i++) {
			from = grades[i];
			to = grades[i + 1];

			labels.push(
				'<i style="background:' + getColorFill_abcount(from + 1) + '"></i> ' +
				from + (to ? '&ndash;' + to : '+'));
		}

		div.innerHTML = labels.join('<br>');
		return div;
	};

	legend.addTo(map);

</script>

<script> src= "State-of-Abortion-Rights/piecharts.js"</script>

<!-- At the very bottom: -->
<p>



</p>
    <footer>
        <div>
            <a href=table.html>Click here for a condensed table of this information. </a>
        </div>
        <div>
            <p>

            
            </p>
        </div>
        <div>
            To learn more about abortions visit:
        </div>
        <div>
            <ul>
                <li><a href= "https://www.guttmacher.org/news-release/2022/abortion-after-roe-new-comprehensive-map-tracks-abortion-policies-and-statistics">Abortion After Roe </a></li>
                <li><a href= "https://lawatlas.org/datasets/abortion-laws">State Abortion Laws</a></li>
                <li><a href= "https://datainnovation.org/2017/09/mapping-the-accessibility-of-abortion-clinics/">Accessibility of Abortion Clinics </a></li>
            </ul>
        </div>
        <div>
            Sources:
            <ul>
                <li><a href="https://data.guttmacher.org/regions">Guttmacher Institute Data Center</a></li>
            </ul>

        </div>
    </footer>

</body>
<script src="../html/mainmap.js"></script>
</html>